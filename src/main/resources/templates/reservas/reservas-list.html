<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="~{layout :: scaffold(~{::section})}">
    <section>
        <!-- Header + CTA -->
        <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
            <h2 style="margin:0;display:flex;align-items:center;gap:8px;">üìë Reservas</h2>
            <div style="display:flex;gap:10px;">
                <a th:href="@{/admin}" style="text-decoration:none;padding:10px 14px;border:1px solid #bfa58c;border-radius:999px;color:#5a4635;font-weight:700;">‚Üê Volver al Panel</a>
                <a th:href="@{/reservas/nueva}"
                   style="text-decoration:none;padding:10px 14px;background:#2ecc71;color:#fff;border-radius:999px;font-weight:800;">
                    + Nueva Reserva
                </a>
            </div>
        </header>

        <!-- Tabla -->
        <div style="overflow:auto;background:#fffaf7;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.08);">
            <table style="width:100%;border-collapse:separate;border-spacing:0;">
                <thead>
                <tr style="background:#fbf5ee;color:#3e2f22;">
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Mascota</th>
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Tutor</th>
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Servicio</th>
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Inicio</th>
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Fin</th>
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Estado</th>
                    <th style="text-align:left;padding:14px 16px;border-bottom:1px solid #eadfd2;">Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="r : ${reservas}" style="background:#fff;">
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;" th:text="${r.mascota != null ? r.mascota.nombre : '-'}">Sombra</td>
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;" th:text="${r.mascota != null && r.mascota.usuario != null ? r.mascota.usuario.nombre : '-'}">Nicol√°s Ramos</td>
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;" th:text="${r.servicio != null ? r.servicio.nombre : '-'}">Hospedaje diario</td>
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;" th:text="${#temporals.format(r.fechaInicio, 'yyyy-MM-dd')}">2025-01-01</td>
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;" th:text="${#temporals.format(r.fechaFin, 'yyyy-MM-dd')}">2025-01-05</td>

                    <!-- Badge de estado -->
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;">
                        <span th:with="e=${r.estado}"
                              th:text="${e}"
                              th:style="${e.name()=='PENDIENTE' ? 'background:#fff4e6;color:#8a5a00' :
                                         (e.name()=='CONFIRMADA' ? 'background:#e8fff3;color:#046c4e' :
                                         (e.name()=='CANCELADA' ? 'background:#ffecef;color:#7a1d28' : 'background:#eef2ff;color:#1f3a8a'))}
                                         + ';padding:6px 10px;border-radius:999px;font-weight:700;display:inline-block;'">
                            PENDIENTE
                        </span>
                    </td>

                    <!-- Acciones -->
                    <td style="padding:14px 16px;border-bottom:1px solid #f0e8de;">
                        <!-- Cambiar estado -->
                        <form th:action="@{|/reservas/${r.id}/estado|}" method="post"
                              style="display:inline-flex;align-items:center;gap:8px;margin-right:8px;">
                            <select name="value"
                                    style="padding:8px 10px;border-radius:10px;border:1px solid #d9cbb8;">
                                <option th:each="e : ${T(com.clubdelcan.crud.entity.Reserva.Estado).values()}"
                                        th:value="${e}" th:text="${e}"
                                        th:selected="${e == r.estado}"></option>
                            </select>
                            <!-- CSRF -->
                            <th:block th:with="csrf=${#request.getAttribute('org.springframework.security.web.csrf.CsrfToken')} ?: ${#request.getAttribute('_csrf')}"
                                      th:if="${csrf != null}">
                                <input type="hidden" th:name="${csrf.parameterName}" th:value="${csrf.token}"/>
                            </th:block>
                            <button type="submit"
                                    style="padding:8px 12px;background:#f39c12;border:none;border-radius:999px;color:#fff;font-weight:800;cursor:pointer;">
                                Cambiar
                            </button>
                        </form>

                        <!-- Eliminar -->
                        <form th:action="@{|/reservas/${r.id}/eliminar|}" method="post" style="display:inline;">
                            <th:block th:with="csrf=${#request.getAttribute('org.springframework.security.web.csrf.CsrfToken')} ?: ${#request.getAttribute('_csrf')}"
                                      th:if="${csrf != null}">
                                <input type="hidden" th:name="${csrf.parameterName}" th:value="${csrf.token}"/>
                            </th:block>
                            <button type="submit" onclick="return confirm('¬øEliminar reserva?')"
                                    style="padding:8px 12px;background:#e74c3c;border:none;border-radius:999px;color:#fff;font-weight:800;cursor:pointer;">
                                Eliminar
                            </button>
                        </form>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(reservas)}">
                    <td colspan="7" style="padding:16px;text-align:center;color:#666;">
                        Sin reservas.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>
</body>
</html>
